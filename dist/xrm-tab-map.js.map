{"version":3,"file":"xrm-tab-map.js","sources":["../src/data/environment-variable.ts","../src/data/processor.ts","../src/xrm-tab-map.ts"],"sourcesContent":["class EnvironmentVariable {\n  public static async getDefaultValue(name: string): Promise<any> {\n    try {\n      return Xrm.WebApi.retrieveMultipleRecords(\n        \"EnvironmentVariableDefinition\",\n        `?$select=defaultvalue&$filter=schemaname eq '${name}'&$top=1`\n      ).then(response => {\n        if (response && response.entities && response.entities.length === 1) {\n          const environmentVariable = response.entities[0];\n          return environmentVariable.defaultvalue;\n        } else {\n          console.log(\n            `No environment variable definition found matching the schema name: ${name}.`\n          );\n        }\n      });\n    } catch (e) {\n      console.log(e.message);\n    }\n  }\n}\n\nexport default EnvironmentVariable;\n","class Processor {\n  public static isJsonString(str) {\n    try {\n      JSON.parse(str);\n    } catch (e) {\n      return false;\n    }\n    return true;\n  }\n}\n\nexport default Processor;\n","import EnvironmentVariable from \"./data/environment-variable\";\nimport Processor from \"./data/processor\";\nimport Config from \"./model/xrm-tab-map-config\";\nimport TabMap from \"./model/tab-map\";\n\nclass XrmTabMap {\n  public static async setDefaultTab(\n    executionContext: Xrm.Events.EventContext,\n    config: Config\n  ): Promise<void> {\n    try {\n      // Validate input config.\n      if (!config || !config.environmentVariableName || !config.optionSetName) {\n        console.log(`Config passed to XrmTabMap is invalid or empty.`);\n        return;\n      }\n\n      // Get value of environment variable.\n      const environmentVariableValue = await EnvironmentVariable.getDefaultValue(\n        config.environmentVariableName\n      );\n\n      // Validate environment variable value is JSON.\n      if (!Processor.isJsonString(environmentVariableValue)) {\n        console.log(\n          `Environment variable default value is not valid JSON. Value received: ${environmentVariableValue}`\n        );\n        return;\n      }\n\n      // Get option set value from form.\n      const formContext = executionContext.getFormContext();\n      const option = formContext.getAttribute(config.optionSetName);\n\n      if (!option) {\n        console.log(\n          `Unable to get option set attribute from given schema name: ${config.optionSetName}`\n        );\n        return;\n      }\n\n      const optionValue = option.getValue();\n\n      // Parse environment variable JSON.\n      const tabMap = <TabMap[]>JSON.parse(environmentVariableValue);\n\n      // Find matching tab from given option set value.\n      const map = tabMap.find(map => map.option === optionValue);\n\n      if (!map || !map.tab) {\n        console.log(\n          `Unable to retrieve mapping for option value: ${optionValue}`\n        );\n        return;\n      }\n\n      // Set focus tab.\n      formContext.ui.tabs.get(map.tab).setFocus();\n    } catch (e) {\n      console.error(`${e}`);\n    }\n  }\n}\n\nexport default XrmTabMap;\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;IAAA;KAoBC;IAnBqB,mCAAe,GAAnC,UAAoC,IAAY;uCAAG,OAAO;;gBACxD,IAAI;oBACF,sBAAO,GAAG,CAAC,MAAM,CAAC,uBAAuB,CACvC,+BAA+B,EAC/B,kDAAgD,IAAI,aAAU,CAC/D,CAAC,IAAI,CAAC,UAAA,QAAQ;4BACb,IAAI,QAAQ,IAAI,QAAQ,CAAC,QAAQ,IAAI,QAAQ,CAAC,QAAQ,CAAC,MAAM,KAAK,CAAC,EAAE;gCACnE,IAAM,mBAAmB,GAAG,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;gCACjD,OAAO,mBAAmB,CAAC,YAAY,CAAC;6BACzC;iCAAM;gCACL,OAAO,CAAC,GAAG,CACT,wEAAsE,IAAI,MAAG,CAC9E,CAAC;6BACH;yBACF,CAAC,EAAC;iBACJ;gBAAC,OAAO,CAAC,EAAE;oBACV,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;iBACxB;;;;KACF;IACH,0BAAC;AAAD,CAAC;;ACpBD;IAAA;KASC;IARe,sBAAY,GAA1B,UAA2B,GAAG;QAC5B,IAAI;YACF,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;SACjB;QAAC,OAAO,CAAC,EAAE;YACV,OAAO,KAAK,CAAC;SACd;QACD,OAAO,IAAI,CAAC;KACb;IACH,gBAAC;AAAD,CAAC;;ACJD;IAAA;KAyDC;IAxDqB,uBAAa,GAAjC,UACE,gBAAyC,EACzC,MAAc;uCACb,OAAO;;;;;;;wBAGN,IAAI,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,uBAAuB,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE;4BACvE,OAAO,CAAC,GAAG,CAAC,iDAAiD,CAAC,CAAC;4BAC/D,sBAAO;yBACR;wBAGgC,qBAAM,mBAAmB,CAAC,eAAe,CACxE,MAAM,CAAC,uBAAuB,CAC/B,EAAA;;wBAFK,wBAAwB,GAAG,SAEhC;;wBAGD,IAAI,CAAC,SAAS,CAAC,YAAY,CAAC,wBAAwB,CAAC,EAAE;4BACrD,OAAO,CAAC,GAAG,CACT,2EAAyE,wBAA0B,CACpG,CAAC;4BACF,sBAAO;yBACR;wBAGK,WAAW,GAAG,gBAAgB,CAAC,cAAc,EAAE,CAAC;wBAChD,MAAM,GAAG,WAAW,CAAC,YAAY,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;wBAE9D,IAAI,CAAC,MAAM,EAAE;4BACX,OAAO,CAAC,GAAG,CACT,gEAA8D,MAAM,CAAC,aAAe,CACrF,CAAC;4BACF,sBAAO;yBACR;wBAEK,gBAAc,MAAM,CAAC,QAAQ,EAAE,CAAC;wBAGhC,MAAM,GAAa,IAAI,CAAC,KAAK,CAAC,wBAAwB,CAAC,CAAC;wBAGxD,GAAG,GAAG,MAAM,CAAC,IAAI,CAAC,UAAA,GAAG,IAAI,OAAA,GAAG,CAAC,MAAM,KAAK,aAAW,GAAA,CAAC,CAAC;wBAE3D,IAAI,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE;4BACpB,OAAO,CAAC,GAAG,CACT,kDAAgD,aAAa,CAC9D,CAAC;4BACF,sBAAO;yBACR;;wBAGD,WAAW,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,QAAQ,EAAE,CAAC;;;;wBAE5C,OAAO,CAAC,KAAK,CAAC,KAAG,GAAG,CAAC,CAAC;;;;;;KAEzB;IACH,gBAAC;AAAD,CAAC;;;;"}